<!DOCTYPE html>
<html lang="ukr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AR Quick Look ‚Äî Archangel Michael</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    /* –°—Ç–∏–ª–∏ –∫–Ω–æ–ø–∫–∏ */
    .ar-button {
      background-color: #007bff;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 20px;
    }
    .ar-button:hover {
      background-color: #0056b3;
    }
    model-viewer {
      width: 100%;
      max-width: 600px;
      height: 500px;
      border-radius: 12px;
      background: #f0f0f0;
      margin-top: 20px;
    }
  </style>
</head>
<body style="text-align:center; padding:50px; font-family:sans-serif;">
  <h1>AR Michael</h1>
  <p>iPhone/iPad only:</p>

  <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ AR -->
  <button id="ar-button" class="ar-button">
    üì± Open AR
  </button>

  <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –≤–æ –≤–Ω–µ—à–Ω–µ–º –±—Ä–∞—É–∑–µ—Ä–µ (Safari/Chrome), —Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é -->
  <button id="open-browser" class="ar-button" style="display:none;">
    üåê Open in Safari/Chrome
  </button>

  <!-- 3D-–ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä -->
  <model-viewer
    id="ar-viewer"
    src="https://vitalii-hton.github.io/weisworld1/halloween.glb"
    ios-src="https://vitalii-hton.github.io/weisworld1/halloween22.usdz#callToAction=Join%20Campaign&checkoutTitle=Weis%20World&checkoutSubtitle=Join%20the%20movement&checkoutURL=https://www.weis.world/ua/campaign#join"
    alt="3D Model"
    camera-controls
    auto-rotate
    ar
    ar-modes="quick-look"
    style="width:100%; height:500px;">
  </model-viewer>

  <!-- –°–∫—Ä—ã—Ç–∞—è –∫–Ω–æ–ø–∫–∞ –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞ -->
  <button id="hidden-ar-button" style="display:none;"></button>

  <script>
    const arButton = document.getElementById('ar-button');
    const arViewer = document.getElementById('ar-viewer');

    // –æ–±—ã—á–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ AR
    arButton.addEventListener('click', () => {
      arViewer.activateAR();
    });

    // —Å–∫—Ä—ã—Ç–∞—è –∫–Ω–æ–ø–∫–∞ –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
    const hiddenBtn = document.getElementById('hidden-ar-button');
    hiddenBtn.addEventListener("click", () => {
      arViewer.activateAR();
    });

    // –∏–º–∏—Ç–∞—Ü–∏—è –∫–ª–∏–∫–∞ –ø–æ —Å–∫—Ä—ã—Ç–æ–π –∫–Ω–æ–ø–∫–µ —á–µ—Ä–µ–∑ 1.5 —Å–µ–∫
    window.addEventListener("load", () => {
      setTimeout(() => {
        hiddenBtn.click();
      }, 1500);
    });

    // ===============================
    // –õ–û–ì–ò–ö–ê –¥–ª—è –∫–Ω–æ–ø–∫–∏ "Open in Safari/Chrome"
    // ===============================
    (function() {
      const openBtn = document.getElementById('open-browser');
      const url = window.location.href; 
      const ua = navigator.userAgent || '';

      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä (Instagram/FB)
      const isInAppBrowser = /Instagram|FBAN|FBAV|FBSV|FB_IAB/i.test(ua);
      if (!isInAppBrowser) {
        openBtn.style.display = 'none';
      } else {
        openBtn.style.display = 'inline-block';
      }

      function tryOpen(urlToOpen) {
        const a = document.createElement('a');
        a.href = urlToOpen;
        a.target = '_blank';
        a.rel = 'noopener noreferrer';
        a.style.display = 'none';
        document.body.appendChild(a);
        a.click();
        setTimeout(()=>{ try { document.body.removeChild(a); } catch(e){} }, 2000);
      }

      function openInExternalBrowser() {
        const xSafari = 'x-safari-https://' + url.replace(/^https?:\/\//i, '');
        const safariTab = 'com-apple-mobilesafari-tab:' + url;
        const intentUrl = 'intent://' + url.replace(/^https?:\/\//i, '') +
                          '#Intent;scheme=https;package=com.android.chrome;end';

        tryOpen(xSafari);                   // –ø–æ–ø—ã—Ç–∫–∞ 1 (iOS)
        setTimeout(()=> tryOpen(safariTab), 300);   // –ø–æ–ø—ã—Ç–∫–∞ 2 (—Å—Ç–∞—Ä—ã–π iOS)
        setTimeout(()=> tryOpen(intentUrl), 700);   // –ø–æ–ø—ã—Ç–∫–∞ 3 (Android)
        setTimeout(()=> tryOpen(url), 1100);        // fallback –æ–±—ã—á–Ω—ã–π
        setTimeout(()=> {
          try { window.open(url, '_blank', 'noopener'); } catch(e){}
        }, 1400);
      }

      openBtn.addEventListener('click', (e) => {
        e.preventDefault();
        openInExternalBrowser();// —á–µ—Ä–µ–∑ 1.6—Å –ø–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        setTimeout(()=> {
          if (confirm('–ï—Å–ª–∏ —Å–∞–π—Ç –≤—Å—ë –µ—â—ë –æ—Ç–∫—Ä—ã—Ç –≤–Ω—É—Ç—Ä–∏ Instagram –∏ AR –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî –æ—Ç–∫—Ä—ã—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é, –∫–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤ Safari?')) {
            window.location.href = '/open-in-safari-instructions.html';
          }
        }, 1600);
      });
    })();
  </script>
</body>
</html>
